
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="shortcut icon" href="../../assets/ico/favicon.ico">

  <title>Starter Template for Bootstrap</title>

  <!-- Bootstrap core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/custom.css" rel="stylesheet">

  <!-- Just for debugging purposes. Don't actually copy this line! -->
  <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->

      <!-- JQuery libraries -->
      <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
      <script src="http://code.jquery.com/ui/1.9.1/jquery-ui.js"></script>

      <!-- Custom css -->
      <link href="pubnub.css" rel="stylesheet">

      <!-- Pubnub libraries -->
      <script src='http://cdn.pubnub.com/pubnub-3.4.min.js'></script>

      <!-- Pubnub credentials -->
      <script src='cred.js'></script>

      <!-- Load Map -->
      <script src="https://maps.googleapis.com/maps/api/js?AIzaSyBXpGBUg6st-2CP2-t-CwV-qRiMU2i7Z9g&sensor=true"></script>

      <script>

    // When the DOM is ready...
    $(function() {

      // Grab the elements
      var input = $("#input");
      var username = $("#username");
      var channel = $("#channel");
      var buttonSend = $("#buttonSend");
      var buttonHistory = $("#buttonHistory");
      var output = $("#output");

      // Init PubNub
      var pubnub = PUBNUB.init({
        publish_key   : "pub-c-273ee5c6-cded-4915-b196-954c4fc1ba4e",
        subscribe_key : "sub-c-39034c9e-c3a8-11e3-ab7b-02ee2ddab7fe",
        uuid: 'Evert'
      });

      // receive messages
      pubnub.subscribe({
        'channel'   : channel.val(),
        'callback'  : function(message) {
          console.log('Channel = ' + channel.val() )
          output.html(output.html() + '<br />' + message);
        }
      });
      
      channel.on('change', function(){
        pubnub.subscribe({
         'channel'   : channel.val(),
         'callback'  : function(message) {
          console.log('Channel = ' + channel.val() )
          output.html(output.html() + '<br />' + "<h1>" + channel.val() +"</h1>" + message);
        }
      })});
      
      

      // send messages
      buttonSend.on('click', function() {
        if(navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
           console.log("1");
           var lat = position.coords.latitude;
           var lon = position.coords.longitude;
           


           var geocoder = new google.maps.Geocoder();

           var latlng = new google.maps.LatLng(lat, lon);
           geocoder.geocode({'latLng': latlng}, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
              if (results[6]) {   
                console.log(results[6].formatted_address);
                nav = results[6].formatted_address;
              }
            } else {
              alert("Geocoder failed due to: " + status);
            }
          });




           console.log(channel.val());
           console.log( 'plats' + nav);

           pubnub.publish({

            'channel' : channel.val(),
            'message' : "<br /><b>" + username.val() + " says:</b><br />" + input.val() + "<br />" + nav

          });


         });
        }})});













      </script>


    </head>



    <body>

      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Lab 3</a>
          </div>
          <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="#">Home</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>

      <div class="container">
       <div class="row">
        <div class="custom">


          <!-- Form Name -->
          <legend>Chat</legend>

          <!-- Text input-->
          <div class="table">
            <div class="col-md-4">
           
              <input id="input" name="input" type="text" placeholder="Enter chat here" class="form-control input-md">




              <!-- Text input-->
              <div class="table">
             
                <input id="username" name="username" type="text" placeholder="enter username here" class="form-control input-md">


              </div>

              <!-- Select Basic -->
              <div class="table">
                <select id="channel" name="channel" class="form-control">
                  <option value="Movies">Movies</option>
                  <option value="Music">Music</option>
                  <option value="Politics">Politics</option>
                </select>
              </div>


              <!-- Button -->
              <div class="table">
                <button id="buttonSend" name="buttonSend" class="btn btn-inverse">Send</button>
              </div>
            </div>
          </div>

          <div class="col-md-2">
          </div>
          <div class="col-md-4">
            <h1>Live Chat</h1>
            <div id="output" style="margin-top:10px"></div>
          </div>

        </div>


      </div>
    </div><!-- /.container -->













    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
  </body>
  </html>
