
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PubNub</title>

  <!-- JQuery libraries -->
  <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
  <script src="http://code.jquery.com/ui/1.9.1/jquery-ui.js"></script>

  <!-- Bootstrap libraries -->
  <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
  <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">

  <!-- Custom css -->
  <link href="pubnub.css" rel="stylesheet">

  <!-- Pubnub libraries -->
  <script src='http://cdn.pubnub.com/pubnub-3.4.min.js'></script>

  <!-- Pubnub credentials -->
  <script src='cred.js'></script>

    <!-- Load Map -->
  <script src="https://maps.googleapis.com/maps/api/js?AIzaSyBXpGBUg6st-2CP2-t-CwV-qRiMU2i7Z9g&sensor=true"></script>

  <script>

    // When the DOM is ready...
    $(function() {

      // Grab the elements
      var input = $("#input");
      var username = $("#username");
      var channel = $("#channel");
      var buttonSend = $("#buttonSend");
      var buttonHistory = $("#buttonHistory");
      var output = $("#output");

      // Init PubNub
      var pubnub = PUBNUB.init({
        publish_key   : "pub-c-273ee5c6-cded-4915-b196-954c4fc1ba4e",
        subscribe_key : "sub-c-39034c9e-c3a8-11e3-ab7b-02ee2ddab7fe",
        uuid: 'Evert'
      });

      // receive messages
      pubnub.subscribe({
        'channel'   : channel.val(),
        'callback'  : function(message) {
        	console.log('Channel = ' + channel.val() )
          output.html(output.html() + '<br />' + message);
        }
      });
      
      channel.on('change', function(){
      	 pubnub.subscribe({
	      'channel'   : channel.val(),
		  'callback'  : function(message) {
          console.log('Channel = ' + channel.val() )
          output.html(output.html() + '<br />' + "<h1>" + channel.val() +"</h1>" + message);
        }
      })});
      
      

      // send messages
      buttonSend.on('click', function() {
      	 if(navigator.geolocation) {
		  	 navigator.geolocation.getCurrentPosition(function(position) {
			  	 console.log("1");
			  	 var lat = position.coords.latitude;
			  	 var lon = position.coords.longitude;
			  	 nav = lat + " " + lon;


    var geocoder = new google.maps.Geocoder();

    var latlng = new google.maps.LatLng(lat, lon);
    geocoder.geocode({'latLng': latlng}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        if (results[1]) {   
          console.log(results[1].formatted_address);
        }
      } else {
        alert("Geocoder failed due to: " + status);
      }
    });




			  	 console.log(channel.val());
      	console.log( 'plats' + nav);
      	
        pubnub.publish({

          'channel' : channel.val(),
          'message' : username.val() + ":" + " plats = " + nav + "<br />" + input.val()
      
        });

        
      });
    }})});
       
     
  



  

  




  </script>
</head>

<body>
  <div class="container">
    <input class="input-block-level" type="text" placeholder="Enter chat here" id="input">
    <input class="input-block-level" type="text" placeholder="Enter Username here" id="username">

<!-- Select Basic -->
<div class="form-group">
  <label class="col-md-4 control-label" for="selectbasic">Channels</label>
  <div class="col-md-4">
    <select id="channel" name="selectbasic" class="form-control">
      <option value="Movies">Movies</option>
      <option value="Music">Music</option>
      <option value="Politics">Politics</option>
    </select>
  </div>
</div>







    <button id="buttonSend" class="btn">Send</button>
    <button id="buttonHistory" class="btn">History</button>
    <div id="output" style="margin-top:10px"></div>
  </div>
</body>
</html>